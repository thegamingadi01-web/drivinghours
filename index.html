<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DriveLog Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #f1f5f9; padding-bottom: 50px; -webkit-tap-highlight-color: transparent; }
        .card { background: white; border-radius: 12px; padding: 12px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        input, select { border-bottom: 2px solid #e2e8f0; padding: 4px; background: transparent; width: 100%; }
        .btn-save { background: #2563eb; color: white; padding: 8px 20px; border-radius: 20px; font-weight: bold; }
    </style>
</head>
<body class="p-3 font-sans text-slate-900">

    <div class="flex justify-between items-center mb-4">
        <h1 class="text-xl font-bold italic">DriveLog Pro</h1>
        <button onclick="saveShift()" class="btn-save shadow-md active:scale-95">SAVE SHIFT</button>
    </div>

    <div class="grid grid-cols-2 gap-2 mb-4">
        <div class="bg-blue-600 p-2 rounded-xl text-center text-white">
            <div id="wD" class="text-lg font-bold">0.0h</div>
            <div class="text-[8px] uppercase font-bold opacity-80">Wk Drive (56)</div>
        </div>
        <div id="fDCard" class="bg-blue-900 p-2 rounded-xl text-center text-white">
            <div id="fD" class="text-lg font-bold">0.0h</div>
            <div class="text-[8px] uppercase font-bold opacity-80">2-Wk Drive (90)</div>
        </div>
        <div id="wWCard" class="bg-indigo-500 p-2 rounded-xl text-center text-white">
            <div id="wW" class="text-lg font-bold">0.0h</div>
            <div class="text-[8px] uppercase font-bold opacity-80">Wk WTD (60)</div>
        </div>
        <div class="bg-indigo-800 p-2 rounded-xl text-center text-white">
            <div id="fW" class="text-lg font-bold">0.0h</div>
            <div class="text-[8px] uppercase font-bold opacity-80">2-Wk WTD</div>
        </div>
    </div>

    <div class="card">
        <div class="grid grid-cols-2 gap-3">
            <input type="number" id="sM" placeholder="Start Miles" class="text-sm">
            <input type="number" id="eM" placeholder="End Miles" class="text-sm text-right">
        </div>
    </div>

    <div class="card">
        <div class="flex justify-between items-center mb-2">
            <h2 class="font-bold text-sm">Tacho Activity Log</h2>
            <button onclick="addActivity()" class="text-blue-600 text-[10px] font-bold uppercase">+ Add Activity</button>
        </div>
        <div id="actList" class="space-y-2"></div>
        
        <div class="mt-3 pt-2 border-t flex justify-around text-center">
            <div><div id="dayDrive" class="text-sm font-bold text-blue-600">0.0h</div><div class="text-[8px] uppercase">Drive</div></div>
            <div><div id="dayWork" class="text-sm font-bold text-indigo-600">0.0h</div><div class="text-[8px] uppercase">Work</div></div>
            <div><div id="breakStat" class="text-[10px] font-bold text-red-500">No Break</div><div class="text-[8px] uppercase">Status</div></div>
        </div>
    </div>

    <div id="hist"></div>

    <script>
        let logs = JSON.parse(localStorage.getItem('drivingLogs')) || [];
        let activities = [];

        function addActivity() {
            const id = Date.now();
            activities.push({ id, type: 'work', s: '', e: '', d: 0 });
            const row = document.createElement('div');
            row.id = `act-${id}`;
            row.className = "flex items-center gap-1 bg-slate-50 p-2 rounded-lg border";
            row.innerHTML = `
                <select onchange="updateAct(${id},'type',this.value)" class="text-[10px] font-bold bg-white border rounded">
                    <option value="work">ðŸ›  WORK</option>
                    <option value="drive">ðŸš› DRIVE</option>
                    <option value="break">â˜• BREAK</option>
                </select>
                <input type="time" onchange="updateAct(${id},'s',this.value)" class="text-[10px]">
                <span>-</span>
                <input type="time" onchange="updateAct(${id},'e',this.value)" class="text-[10px]">
                <button onclick="rmAct(${id})" class="text-red-500 font-bold px-1 ml-1">Ã—</button>
            `;
            document.getElementById('actList').appendChild(row);
        }

        function rmAct(id) { document.getElementById(`act-${id}`).remove(); activities = activities.filter(x => x.id !== id); calcDay(); }

        function updateAct(id, f, v) {
            const a = activities.find(x => x.id === id); a[f] = v;
            if (a.s && a.e) {
                const [sh, sm] = a.s.split(':').map(Number); const [eh, em] = a.e.split(':').map(Number);
                let m = (eh * 60 + em) - (sh * 60 + sm); if (m < 0) m += 1440;
                a.d = m;
            }
            calcDay();
        }

        function calcDay() {
            let d = 0, w = 0, brks = [];
            activities.forEach(a => {
                if (a.type === 'drive') d += a.d;
                if (a.type === 'work') w += a.d;
                if (a.type === 'break') brks.push(a.d);
            });

            document.getElementById('dayDrive').innerText = (d/60).toFixed(1) + 'h';
            document.getElementById('dayWork').innerText = (w/60).toFixed(1) + 'h';
            
            // Break Logic
            const status = document.getElementById('breakStat');
            if (brks.some(b => b >= 45)) { status.innerText = "âœ“ 45m"; status.className="text-[10px] font-bold text-green-600"; }
            else if (brks.filter(b => b >= 15).length >= 1 && brks.some(b => b >= 30)) { status.innerText = "âœ“ 15/30"; status.className="text-[10px] font-bold text-green-600"; }
            else { status.innerText = "Ã— NO BREAK"; status.className="text-[10px] font-bold text-red-500"; }
            
            return { drive: d/60, work: w/60, totalWTD: (d+w)/60 };
        }

        function saveShift() {
            const day = calcDay();
            const sM = parseInt(document.getElementById('sM').value) || 0;
            const eM = parseInt(document.getElementById('eM').value) || 0;
            
            if (activities.length === 0) return alert("Add some activities first");

            logs.unshift({
                date: new Date().toLocaleDateString('en-GB'),
                ts: Date.now(),
                miles: eM - sM,
                dH: day.drive,
                oH: day.work,
                tW: day.totalWTD
            });

            localStorage.setItem('drivingLogs', JSON.stringify(logs));
            document.getElementById('sM').value = eM;
            document.getElementById('eM').value = '';
            document.getElementById('actList').innerHTML = '';
            activities = [];
            refH();
        }

        function refH() {
            const h = document.getElementById('hist'); let wD=0, fD=0, wW=0, fW=0; const n = Date.now();
            h.innerHTML = logs.map((l, i) => {
                const a = (n - l.ts) / 86400000;
                if (a <= 7) { wD += l.dH; wW += l.tW; }
                if (a <= 14) { fD += l.dH; fW += l.tW; }
                return `<div class="card mb-2 flex justify-between items-center text-xs font-bold"><div>${l.date}</div><div class="text-blue-600">D: ${l.dH.toFixed(1)}h</div><div class="text-indigo-600">W: ${l.oH.toFixed(1)}h</div><div>${l.miles}mi</div></div>`;
            }).join('');
            document.getElementById('wD').innerText = wD.toFixed(1) + 'h';
            document.getElementById('fD').innerText = fD.toFixed(1) + 'h';
            document.getElementById('wW').innerText = wW.toFixed(1) + 'h';
            document.getElementById('fW').innerText = fW.toFixed(1) + 'h';
        }
        refH();
    </script>
</body>
</html>
